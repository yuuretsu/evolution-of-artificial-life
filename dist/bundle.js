(()=>{"use strict";var t={184:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.Genome=void 0;var a=n(571),c=n(439),s=n(812),l=function(t){function e(n,r,o,i,s,l,u,h){var d=t.call(this,n,r,o,i)||this;return d.energy=s,d.genome=l,d.family=u,d.abilities=h,e.amount++,d._narrow=c.randInt(0,8),d.age=0,d.lastAction={name:"none",color:new a.Rgba(20,20,20,255)},d}return o(e,t),Object.defineProperty(e.prototype,"narrow",{get:function(){return this._narrow},set:function(t){this._narrow=c.fixNumber(0,8,t)},enumerable:!1,configurable:!0}),e.prototype.narrowToCoords=function(){var t=this.x+s.MOORE_NEIGHBOURHOOD[this.narrow][0],e=this.y+s.MOORE_NEIGHBOURHOOD[this.narrow][1];return this.world.fixCoords(t,e)},e.prototype.getForvard=function(){var t,e=this.narrowToCoords();return{block:(t=this.world).get.apply(t,e),coords:e}},e.prototype.moveTo=function(t,e){this.world.swap(this.x,this.y,t,e)},e.prototype.multiplyTo=function(t,n){new e(this.world,t,n,this.color.interpolate(new a.Rgba(255,255,255,255),.25),this.energy/3,this.genome.replication(),this.family.mutateRgb(10),i({},this.abilities)),this.energy/=3},e.prototype.randMove=function(){var t=this.world.fixCoords(this.x+c.randInt(-1,2),this.y+c.randInt(-1,2));this.moveTo.apply(this,t)},e.prototype.onStep=function(){this.energy<1||this.energy>100||this.age>2e3?this.alive=!1:(this.genome.doAction(this),this.energy-=.1,this.age+=1)},e.prototype.onDie=function(){e.amount--},e.amount=0,e}(s.DynamicBlock);e.default=l;var u=function(t){function e(e){var n=t.call(this,e.world,e.x,e.y,e.color.interpolate(new a.Rgba(0,0,0,255),.5))||this;return n.age=0,n}return o(e,t),e.prototype.onStep=function(){this.age>500&&(this.alive=!1),this.color=this.color.interpolate(new a.Rgba(10,10,50,255),.005),this.age++},e}(s.DynamicBlock),h=function(){function t(t){this.length=t,this.genes=[],this._pointer=0}return Object.defineProperty(t.prototype,"pointer",{get:function(){return this._pointer},set:function(t){this._pointer=c.fixNumber(0,this.length,t)},enumerable:!1,configurable:!0}),t.prototype.randGene=function(){return{action:c.randChoice(d),property:Math.random(),branches:[c.randInt(0,this.length),c.randInt(0,this.length),c.randInt(0,this.length),c.randInt(0,this.length)]}},t.prototype.mutateGene=function(t){var e=this;return{action:Math.random()>.9?c.randChoice(d):t.action,property:c.limNumber(0,1,t.property+c.randFloat(-.01,.01)),branches:t.branches.map((function(t){return Math.random()>.9?c.randInt(0,e.length):t}))}},t.prototype.fillRandom=function(t){void 0===t&&(t=0);for(var e=t;e<this.length;e++)this.genes[e]=this.randGene();return this},t.prototype.create=function(t){for(var e=0;e<t.length;e++)this.genes[e]=t[e];return this.fillRandom(t.length),this},t.prototype.fillPlant=function(){for(var t=0;t<this.length;t++)this.genes[t]={action:d[c.randInt(0,3)],property:Math.random(),branches:[c.randInt(0,this.length),c.randInt(0,this.length),c.randInt(0,this.length),c.randInt(0,this.length)]};return this},t.prototype.replication=function(){for(var e=new t(this.length),n=0;n<this.length;n++)e.genes[n]=Math.random()>.995?this.mutateGene(this.genes[n]):this.genes[n];return e},t.prototype.doAction=function(t){for(var e=0;e<20;e++){var n=this.genes[this.pointer],r=n.action(t,n.property,n.branches);if(r.goto?this.pointer=r.goto:this.pointer++,r.completed)return}t.lastAction={name:"view-do-nothing",color:new a.Rgba(50,50,50,255)},t.color=t.color.interpolate(new a.Rgba(100,100,100,255),.1)},t}();e.Genome=h;var d=[function(t,e,n){return{completed:!1,goto:0}},function(t,e,n){return t.energy+=.5*Math.pow(t.abilities.photo,2),t.abilities.photo=Math.min(1,t.abilities.photo+.01),t.abilities.attack=Math.max(0,t.abilities.attack-.01),t.color=t.color.interpolate(new a.Rgba(0,255,0,255),.01),t.lastAction={name:"view-photosynthesis",color:new a.Rgba(0,200,0,255)},{completed:!0}},function(t,e,n){return e>.5?t.narrow++:t.narrow--,{completed:!1}},function(t,e,n){var r=t.getForvard();return!r.block&&t.age>2&&(t.multiplyTo.apply(t,r.coords),t.lastAction={name:"view-multiply",color:new a.Rgba(0,0,200,255)}),{completed:!0}},function(t,e,n){t.color=t.color.interpolate(new a.Rgba(0,0,255,255),.005);var r=t.getForvard();if(r.block instanceof l&&r.block.energy<t.energy){var o=(r.block.energy+t.energy)/2;t.energy=o,r.block.energy=o,t.lastAction={name:"view-share-energy",color:new a.Rgba(0,150,150,255)}}return{completed:!0}},function(t,e,n){var r=t.getForvard();return r.block instanceof l?r.block.family.difference(t.color)<e?{completed:!1,goto:n[0]}:{completed:!1,goto:n[1]}:r.block instanceof u?{completed:!1,goto:n[2]}:{completed:!1,goto:n[3]}},function(t,e,n){return t.energy/100<e?{completed:!1,goto:n[0]}:{completed:!1,goto:n[1]}},function(t,e,n){var r=t.getForvard();return r.block instanceof u&&r.block.age>2&&(r.block.alive=!1),{completed:!0}},function(t,e,n){var r=t.getForvard();return r.block||t.moveTo.apply(t,r.coords),t.lastAction={name:"view-move",color:new a.Rgba(150,150,150,255)},{completed:!0}},function(t,e,n){t.energy-=.1,t.color=t.color.interpolate(new a.Rgba(255,0,0,255),.01),t.abilities.attack=Math.min(1,t.abilities.attack+.01),t.abilities.photo=Math.max(0,t.abilities.photo-.01);var r=t.getForvard();if(r.block instanceof l){var o=r.block.energy/2*Math.pow(t.abilities.attack,2);r.block.energy-=r.block.energy/2,t.energy+=o,t.lastAction={name:"view-attack",color:new a.Rgba(200,0,0,255)}}return{completed:!0}}]},140:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});var r=n(439),o=function(){function t(t,e){this.width=t,this.height=e,this.cells=[];for(var n=0;n<t;n++)this.cells[n]=[]}return t.prototype.get=function(t,e){return this.cells[t][e]},t.prototype.set=function(t,e,n){this.cells[t][e]=n},t.prototype.remove=function(t,e){delete this.cells[t][e]},t.prototype.swap=function(t,e,n,r){var o=this.get(t,e),i=this.get(n,r);this.set(t,e,i),this.set(n,r,o)},t.prototype.fixCoords=function(t,e){return[r.fixNumber(0,this.width,t),r.fixNumber(0,this.height,e)]},t.prototype.randCoords=function(){return[r.randInt(0,this.width),r.randInt(0,this.height)]},t.prototype.randEmpty=function(){var t;do{t=this.randCoords()}while(this.get.apply(this,t));return t},t}();e.default=o},571:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.PixelsData=e.Canvas=e.Rgba=void 0;var i=n(439),a=function(){function t(t,e,n,r){this.red=t,this.green=e,this.blue=n,this.alpha=r}return t.randRgb=function(){return new t(i.randInt(0,256),i.randInt(0,256),i.randInt(0,256),255)},t.prototype.interpolate=function(e,n){return new t(i.interpolate(this.red,e.red,n),i.interpolate(this.green,e.green,n),i.interpolate(this.blue,e.blue,n),i.interpolate(this.alpha,e.alpha,n))},t.prototype.normalise=function(){return new t(i.limNumber(0,255,this.red),i.limNumber(0,255,this.green),i.limNumber(0,255,this.blue),i.limNumber(0,255,this.alpha))},t.prototype.mutateRgb=function(e){return new t(this.red+i.randFloat(-e,e),this.green+i.randFloat(-e,e),this.blue+i.randFloat(-e,e),this.alpha).normalise()},t.prototype.difference=function(e){return(Math.abs(this.red-e.red)+Math.abs(this.green-e.green)+Math.abs(this.blue-e.blue)+Math.abs(this.alpha-e.alpha))/t.MAX_DIF},t.MAX_DIF=1020,t}();e.Rgba=a;var c=function(t,e,n){this.node=n||document.createElement("canvas"),this.node.width=t,this.node.height=e,this.ctx=this.node.getContext("2d")};e.Canvas=c;var s=function(t){function e(e,n,r){var o=t.call(this,e,n,r)||this;return o.data=o.ctx.getImageData(0,0,o.node.width,o.node.height),o}return o(e,t),e.prototype.setPixel=function(t,e,n){var r=4*(e*this.data.width+t);this.data.data[r]=n.red,this.data.data[r+1]=n.green,this.data.data[r+2]=n.blue,this.data.data[r+3]=n.alpha},e.prototype.update=function(){return this.ctx.putImageData(this.data,0,0),this},e}(c);e.PixelsData=s},439:function(t,e){var n=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};function r(t,e){return Math.random()*(e-t)+t}function o(t,e){return Math.floor(r(t,e))}Object.defineProperty(e,"__esModule",{value:!0}),e.interpolate=e.limNumber=e.normalizeNumber=e.fixNumber=e.randChoice=e.randInt=e.randFloat=e.range=void 0,e.range=function(t,e){return n(this,(function(n){switch(n.label){case 0:return t<e?[4,t++]:[3,2];case 1:return n.sent(),[3,0];case 2:return[2]}}))},e.randFloat=r,e.randInt=o,e.randChoice=function(t){return t[o(0,t.length)]},e.fixNumber=function(t,e,n){return n>=t?n%e:e- -n%e},e.normalizeNumber=function(t,e,n){return(n-t)/(e-t)},e.limNumber=function(t,e,n){return Math.max(Math.min(n,e),t)},e.interpolate=function(t,e,n){return t+(e-t)*n}},903:function(t,e,n){var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r};Object.defineProperty(e,"__esModule",{value:!0}),e.getNarrowImg=e.drawLastAction=e.drawFamilies=e.drawAbilities=e.drawEnergy=e.drawColors=void 0;var o=n(184),i=n(571),a=n(439),c=n(812);e.drawColors=function(t){return t instanceof c.Block?t.color:null},e.drawEnergy=function(t){return function(e){return e instanceof o.default?new i.Rgba(20,20,100,255).interpolate(new i.Rgba(255,255,0,255),e.energy/t):null}},e.drawAbilities=function(t){return t instanceof o.default?new i.Rgba(255*a.normalizeNumber(.5,1,t.abilities.attack),255*a.normalizeNumber(.5,1,t.abilities.photo),50,255):null},e.drawFamilies=function(t){return t instanceof o.default?t.family:null},e.drawLastAction=function(t){return function(e){return e instanceof o.default?t[e.lastAction.name]?e.lastAction.color:new i.Rgba(20,20,20,255):null}},e.getNarrowImg=function(t){for(var e=new i.PixelsData(3*t.width,3*t.height),n=0;n<t.width;n++)for(var a=0;a<t.height;a++){var s=t.get(n,a);if(s instanceof o.default){var l=[3*s.x+1+c.MOORE_NEIGHBOURHOOD[s.narrow][0],3*s.y+1+c.MOORE_NEIGHBOURHOOD[s.narrow][1]];e.setPixel.apply(e,r(l,[new i.Rgba(0,0,0,127)]))}}return e.update(),e.node}},812:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.World=e.DynamicBlock=e.Block=e.MOORE_NEIGHBOURHOOD=void 0;var i=n(571),a=n(140),c=n(439);e.MOORE_NEIGHBOURHOOD=[[-1,-1],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0]];var s=function(t,e,n,r){this.world=t,this.x=e,this.y=n,this.color=r,t.set(e,n,this)};e.Block=s;var l=function(t){function e(e,n,r,o){var i=t.call(this,e,n,r,o)||this;return e.assign(i),i.alive=!0,i}return o(e,t),e.prototype.onStep=function(){},e.prototype.onDie=function(){},e}(s);e.DynamicBlock=l;var u=function(t){function e(e,n,r,o){var a=t.call(this,e,n)||this;return a.width=e,a.height=n,a.img=new i.Canvas(e*r,n*r,o),a.img.ctx.imageSmoothingEnabled=!1,a.dynamic={a:{},b:{}},a.age=0,a}return o(e,t),e.prototype.set=function(e,n,r){t.prototype.set.call(this,e,n,r),r&&(r.x=e,r.y=n)},e.prototype.drawLayer=function(t){this.img.ctx.drawImage(t,0,0,this.img.node.width,this.img.node.height)},e.prototype.clearImage=function(){this.img.ctx.clearRect(0,0,this.img.node.width,this.img.node.height)},e.prototype.visualize=function(t){for(var e=new i.PixelsData(this.width,this.height),n=0;n<this.width;n++)for(var r=0;r<this.height;r++){var o=t(this.get(n,r),n,r);o&&e.setPixel(n,r,o)}this.drawLayer(e.update().node)},e.prototype.assign=function(t){var e;do{e=c.randInt(0,this.width*this.height*1e3)}while(this.dynamic.a[e]);this.dynamic.a[e]=t},e.prototype.init=function(){this.dynamic.b=this.dynamic.a},e.prototype.step=function(){for(var t in this.dynamic.a={},this.dynamic.b){var e=this.dynamic.b[t];e.alive?(e.onStep(),this.assign(e)):(this.set(e.x,e.y,void 0),e.onDie())}this.dynamic.b=this.dynamic.a,this.age++},e}(a.default);e.World=u},519:function(t,e,n){var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r};Object.defineProperty(e,"__esModule",{value:!0});var o=n(184),i=n(571),a=n(439),c=n(903),s=n(812);function l(){document.querySelector(".wrapper").style.maxHeight=window.innerHeight+"px"}var u;window.addEventListener("resize",l),window.addEventListener("load",(function(){var t,e,n;function h(){document.querySelector("#img").style.transform="none",o.default.amount=0,u=new s.World(parseInt(document.querySelector("#input-width").value),parseInt(document.querySelector("#input-height").value),parseInt(document.querySelector("#input-pixel").value),document.querySelector("#img"));for(var t=parseInt(document.querySelector("#input-bots").value),e=0;e<Math.min(u.width*u.height,t);e++)new(o.default.bind.apply(o.default,r([void 0,u],u.randEmpty(),[new i.Rgba(100,100,100,255),100,new o.Genome(64).fillRandom(),i.Rgba.randRgb(),{photo:.5,attack:.5}])));u.init(),d(u,N.value,R,D.checked)}function d(t,e,n,r){switch(t.clearImage(),e){case"normal":t.visualize(c.drawColors);break;case"energy":t.visualize(c.drawEnergy(parseInt(q.value)));break;case"families":t.visualize(c.drawFamilies);break;case"abilities":t.visualize(c.drawAbilities);break;case"action":t.visualize(c.drawLastAction(n))}r&&t.drawLayer(c.getNarrowImg(t))}function p(){C=!0,P.disabled=!0,P.checked=!1}l(),document.querySelectorAll("#input-width, #input-height, #input-pixel").forEach((function(t){t.addEventListener("change",(function(t){var e=t.target;e.value=(a.limNumber(parseInt(e.min),parseInt(e.max),parseInt(e.value))||parseInt(e.min)).toString()}))}));var f,g,m,v,y=document.querySelector("#img-container"),b=document.querySelector("#img");null===(t=document.querySelector("#btn-menu"))||void 0===t||t.addEventListener("change",(function(t){var e,n;t.target.checked?(y.classList.add("img-wrapper--menu-opened"),null===(e=document.querySelector("#menu"))||void 0===e||e.classList.add("wrapper__menu--menu-opened")):(y.classList.remove("img-wrapper--menu-opened"),null===(n=document.querySelector("#menu"))||void 0===n||n.classList.remove("wrapper__menu--menu-opened"))}));var w=0,_=0,k=!1;function O(t){t instanceof TouchEvent?(m=t.touches[0].clientX-w,v=t.touches[0].clientY-_):(m=t.clientX-w,v=t.clientY-_),t.target===b&&(k=!0)}function x(){m=f,v=g,k=!1}function I(t){k&&(t.preventDefault(),t instanceof TouchEvent?(f=t.touches[0].clientX-m,g=t.touches[0].clientY-v):(f=t.clientX-m,g=t.clientY-v),w=f,_=g,b.style.transform="translate3d("+f+"px, "+g+"px, 0)")}y.addEventListener("touchstart",O,!1),y.addEventListener("touchend",x,!1),y.addEventListener("touchmove",I,!1),y.addEventListener("mousedown",O,!1),y.addEventListener("mouseup",x,!1),y.addEventListener("mousemove",I,!1);var R={"view-photosynthesis":!1,"view-attack":!1,"view-multiply":!1,"view-share-energy":!1,"view-move":!1,"view-do-nothing":!1},E=[];for(var M in R)E.push("#"+M);document.querySelectorAll(E.join(",")).forEach((function(t){var e=t;e.addEventListener("change",(function(){R[e.id]=e.checked,d(u,N.value,R,D.checked)}))}));var S=document.querySelector("#amount"),L=document.querySelector("#fps"),A=document.querySelector("#frame-number"),N=document.querySelector("#view-mode"),q=document.querySelector("#view-energy-divider");q.addEventListener("input",(function(){d(u,N.value,R,D.checked)})),N.addEventListener("change",(function(){var t=document.querySelector("#view-modes-options");Array.from(t.children).forEach((function(t){t.id==="view-"+N.value+"-options"?t.classList.remove("hidden"):t.classList.add("hidden")})),d(u,N.value,R,D.checked)}));var D=document.querySelector("#chbx-narrows");D.addEventListener("change",(function(){d(u,N.value,R,D.checked)}));var P=document.querySelector("#chbx-upd-img");null===(e=document.querySelector("#btn-start"))||void 0===e||e.addEventListener("click",h),null===(n=document.querySelector("#btn-step"))||void 0===n||n.addEventListener("click",(function(){p(),u.step(),d(u,N.value,R,D.checked)})),document.querySelector("#btn-pause").addEventListener("click",(function(){switch(C){case!0:C=!1,P.disabled=!1,P.checked=!0;break;case!1:p()}})),h();var j=Date.now(),F=0,C=!1;setInterval((function(){Date.now()-j>1e3&&(L.innerHTML=F.toFixed(0),F=0,j=Date.now()),F++,C||u.step(),P.checked&&d(u,N.value,R,D.checked),S.innerHTML=o.default.amount.toString(),A.innerHTML=""+(u.age/1e3).toFixed(1)}))}))}},e={};!function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}(519)})();
//# sourceMappingURL=bundle.js.map